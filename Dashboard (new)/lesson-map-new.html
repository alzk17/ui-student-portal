<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lambda</title>

    <!-- Vendor CSS -->
    <link rel="stylesheet" href="https://lambda.in.th/assets_dashboard/css/bootstrap.css?v=1754330467" />
    <link rel="stylesheet" href="https://cdn.lineicons.com/5.0/lineicons.css" />
    <link rel="stylesheet" href="https://lambda.in.th/assets_dashboard/css/icofont.css?v=1754330467" />
    <link rel="stylesheet" href="https://lambda.in.th/assets_dashboard/css/styles.css?v=1754330467" />
    <link rel="stylesheet" href="https://lambda.in.th/assets_dashboard/css/font-icon.css?v=1754330467">
    <link rel="stylesheet" href="https://lambda.in.th/assets_dashboard/css/slick.min.css?v=1754330467">
    <link rel="stylesheet" href="https://lambda.in.th/assets_dashboard/css/slick-custom.css?v=1754330467">
    <link rel="stylesheet" href="https://lambda.in.th/assets/cusmike/sweet2/sweetalert2.min.css?v=1754330467">
    <link rel="stylesheet" href="https://lambda.in.th/assets/cusmike/toastr/toastr.min.css?v=1754330467">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/header.css">
    <link rel="stylesheet" href="css/buttons.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/sidebar.css?v=123123123">
    <link rel="stylesheet" href="css/tooltip.css">
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/modal.css">
    <link rel="stylesheet" href="css/tooltip-widgets.css">
    <link rel="stylesheet" href="css/lesson-map.css">
</head>
<body>
    <div class="wrapper">
        <aside id="sidebar" class="expand">
            <!-- Sidebar Logo -->
            <div class="logo-sidebar">
                <div class="sidebar-logo">
                    <a href="https://lambda.in.th/dashboard-child">
                        <img src="https://lambda.in.th/assets_dashboard/img/logos/logo-big.svg" class="logo-expanded" alt="Logo">
                        <img src="https://lambda.in.th/assets_dashboard/img/logos/logo-small.svg" class="logo-collapsed" alt="Small Logo">
                    </a>
                </div>
            </div>

            <!-- Sidebar Navigation -->
            <ul class="sidebar-nav">
                <li class="sidebar-item">
                    <a href="https://lambda.in.th/dashboard-child" class="sidebar-link">
                        <img src="https://lambda.in.th/assets_dashboard/img/icons/home.svg" class="img-fluid img-icon" alt="Home"> 
                        <span>Home</span>
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="https://lambda.in.th/dashboard-child/journey" class="sidebar-link">
                        <img src="https://lambda.in.th/assets_dashboard/img/icons/hat.svg" class="img-fluid img-icon" alt="Learn">
                        <span>Learn</span>
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="https://lambda.in.th/dashboard-child/set-work" class="sidebar-link">
                        <img src="https://lambda.in.th/assets_dashboard/img/icons/target.svg" class="img-fluid img-icon" alt="Set Tasks"> 
                        <span>Set Tasks</span>
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="https://lambda.in.th/dashboard-child/review" class="sidebar-link">
                        <img src="https://lambda.in.th/assets_dashboard/img/icons/magnifier.svg" class="img-fluid img-icon" alt="Review">
                        <span>Review</span>
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="https://lambda.in.th/dashboard-child/worksheet" class="sidebar-link">
                        <img src="https://lambda.in.th/assets_dashboard/img/icons/binders.svg" class="img-fluid img-icon" alt="Resources">
                        <span>Resources</span>
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="https://lambda.in.th/dashboard-child/hangouts" class="sidebar-link">
                        <img src="https://lambda.in.th/assets_dashboard/img/icons/shop.svg" class="img-fluid img-icon-step2" alt="Shop">
                        <span>Shop</span>
                    </a>
                </li>
                <li class="sidebar-item">
                    <a href="https://lambda.in.th/dashboard-child/profile" class="sidebar-link">
                        <img src="https://lambda.in.th/assets_dashboard/img/icons/id.svg" class="img-fluid img-icon-step2" alt="Profile">
                        <span>Profile</span>
                    </a>
                </li>
            </ul>

            <!-- Sidebar Footer -->
            <div class="sidebar-footer">
                <div class="dropdown">
                    <a class="dropdown-toggle sidebar-link" href="javascript:void(0)" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <img src="https://lambda.in.th/assets_dashboard/img/icons/more-test.svg" class="img-fluid img-icon" alt="More"> 
                        <span>More</span>
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="https://lambda.in.th/dashboard-child/settings"><span>Settings</span></a></li>
                        <li><a class="dropdown-item" href="https://lambda.in.th/dashboard-child/help"><span>Help</span></a></li>
                        <li><a class="dropdown-item" href="#" onclick="openProblemReportModal();"><span>Report a problem</span></a></li>
                        <li><div class="dropdown-divider"></div></li>
                        <li><a class="dropdown-item" href="https://lambda.in.th/dashboard-parent"><span>Switch to parent account</span></a></li>
                        <li><a class="dropdown-item" href="javascript:void(0)" onclick="logoutChild();"><span>Log out</span></a></li>
                    </ul>
                </div>
            </div>
        </aside>

        <div class="main">
            <header class="border-header-page">
                <div class="container-custom">
                    <div class="box-headerpage">
                        <div class="search-bar-wrapper">
                            <div class="profile-mini" data-tooltip-id="profile-tooltip">
                                <div class="box-image">
                                    <img src="https://lambda.in.th/uploads/child/child27012025-141619.jpeg" class="img-fluid" alt="Profile">
                                </div>
                                <div class="profile-name">Kwannpat</div>

                                <div class="portal-tooltip portal-tooltip--profile" id="profile-tooltip" style="display: none;">
                                    <div class="tooltip-profile-header">
                                        <img src="https://lambda.in.th/uploads/child/child27012025-141619.jpeg" alt="Profile" class="tooltip-profile-image">
                                        <div class="tooltip-profile-info">
                                            <p class="tooltip-title">Kwannpat Kotiram</p>
                                            <div class="tooltip-info-pair">
                                                <span class="tooltip-label">Age:</span>
                                                <span class="tooltip-value">-</span>
                                            </div>
                                            <div class="tooltip-info-pair">
                                                <span class="tooltip-label">Plan:</span>
                                                <span class="tooltip-value">-</span>
                                            </div>
                                            <p class="tooltip-value">You have 0 days remaining.</p>
                                        </div>
                                    </div>
                                    <div class="tooltip-cta-wrapper">
                                        <a href="/top-up" class="portal-btn portal-btn--primary" style="width: 100%;">Top up now</a>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="right-icons-wrapper">
                            <div class="box-streak">
                                <div><img src="https://lambda.in.th/assets_dashboard/img/icons/bolt.svg" alt="Streak Icon"></div>
                                <div class="streak-counter">233</div>
                            </div>

                            <div class="box-gem" data-tooltip-id="gem-tooltip">
                                <div>
                                    <img src="https://lambda.in.th/assets_dashboard/img/icons/gem.svg" class="img-fluid" alt="Gem Icon">
                                </div>
                                <div class="gem-counter">90</div>

                                <div class="portal-tooltip portal-tooltip--gem" id="gem-tooltip" style="display: none;">
                                    <div class="tooltip-gem-content">
                                        <div class="tooltip-gem-icon">
                                            <img src="https://lambda.in.th/assets_dashboard/img/icons/gem.svg" alt="Gem Icon">
                                        </div>
                                        <div class="tooltip-gem-text">
                                            <p class="gem-count"><span style="color: #375ce3">90</span> Gems</p>
                                            <p class="tooltip-info" style="margin: 0;">
                                                Use them to buy streak shields or items at the
                                                <a href="/dashboard-child/hangouts" class="tooltip-link">Shop</a>.
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="box-notification has-unread" data-tooltip-id="notification-tooltip">
                                <img src="https://lambda.in.th/assets_dashboard/img/icons/bell.svg" alt="Notification Icon">
                            </div>
                        </div>
                    </div>
                </div>
            </header>

            <div class="container-custom">
                <div class="portal-layout">
                    <div class="portal-main portal-main--fullwidth">
                        <!-- Section 1: Course Overview -->
                        <section class="portal-section course-overview">
                            <div class="course-details">
                                <h1 class="course-title">Place Value</h1>
                                <p class="course-description">
                                    Learn the basics of the number system and how numbers are built, starting from simple digits to thousands and beyond.
                                </p>
                                <button type="button" class="portal-btn3d portal-btn3d--blue portal-btn3d--primary btn-start-learning">
                                Continue learning
                                </button>
                            </div>

                            <div class="course-dashboard">
                                <div class="progress-card">
                                    <div class="progress-header">
                                        <div class="progress-title-wrapper">
                                            <span class="progress-label">Course Progress</span>
                                        </div>
                                    </div>

                                    <div class="progress-row">
                                        <div class="progress-bar-bg">
                                            <div class="progress-bar-fill" style="width: 52%;">
                                                <span class="progress-bar-percent">52%</span>
                                            </div>
                                        </div>
                                        <button class="btn-reset-progress" title="Reset course progress" aria-label="Reset course progress">
                                            <i class="fa-solid fa-rotate-left"></i>
                                        </button>
                                    </div>
                                </div>

                                <div class="stats-grid">
                                    <div class="stat-card">
                                        <div class="stat-label">Lessons</div>
                                        <div class="stat-value">6</div>
                                    </div>
                                    <div class="stat-card">
                                        <div class="stat-label">Practices</div>
                                        <div class="stat-value">4</div>
                                    </div>
                                    <div class="stat-card">
                                        <div class="stat-label">Level</div>
                                        <div class="stat-value">Beginner</div>
                                    </div>
                                    <div class="stat-card">
                                        <div class="stat-label">Time to complete</div>
                                        <div class="stat-value">8 hours</div>
                                    </div>
                                </div>
                            </div>
                        </section>
                        
                        <!-- Section 2: Syllabus / Lesson Cards -->
                        <section class="portal-section syllabus-map">
                        <div class="lesson-card-container">

                            <a class="lesson-card is-completed card-link" href="#" aria-label="Review: Ones and Tens (completed)"
                               data-title="Ones and Tens"
                               data-review-url="/course/foundations/lesson/1/review"
                               data-restart-url="/course/foundations/lesson/1/start">
                                <div class="card-index" aria-hidden="true">1</div>
                                <div class="card-content">
                                    <div class="card-tags">
                                        <span class="tag tag--type">Lesson</span>
                                    </div>
                                    <h3 class="card-title">Ones and Tens</h3>
                                    <p class="card-meta">You’ve completed this lesson.</p>
                                </div>
                                <div class="card-state-icon" aria-hidden="true"><i class="fa-solid fa-circle-check"></i></div>
                            </a>

                            <a class="lesson-card is-completed card-link" href="#" aria-label="Review: 3‑Digit Numbers (completed)"
                               data-title="3‑Digit Numbers"
                               data-review-url="/course/foundations/lesson/2/review"
                               data-restart-url="/course/foundations/lesson/2/start">
                                <div class="card-index" aria-hidden="true">2</div>
                                <div class="card-content">
                                    <div class="card-tags">
                                        <span class="tag tag--type">Practice</span>
                                    </div>
                                    <h3 class="card-title">3‑Digit Numbers</h3>
                                    <p class="card-meta">Practice makes perfect!</p>
                                </div>
                                <div class="card-state-icon" aria-hidden="true"><i class="fa-solid fa-circle-check"></i></div>
                            </a>

                            <a class="lesson-card is-current card-link" href="#" aria-label="Start: Thousands (current)" aria-current="step">
                                <div class="card-index" aria-hidden="true">3</div>
                                <div class="card-content">
                                    <div class="card-tags">
                                        <span class="tag tag--type">Lesson</span>
                                    </div>
                                    <h3 class="card-title">Thousands</h3>
                                    <p class="card-meta">This is your next lesson.</p>
                                </div>
                                <div class="card-state-icon" aria-hidden="true"><i class="fa-solid fa-play"></i></div>
                            </a>

                            

                            <div class="lesson-card is-locked" aria-label="Locked: Place Value Mastery" role="button" tabindex="0"
                                 data-title="Place Value Mastery"
                                 data-start-url="/course/foundations/lesson/4/start"
                                 data-current-url="/course/foundations/lesson/3/resume"
                                 data-current-title="Thousands">
                                <div class="card-index" aria-hidden="true">4</div>
                                <div class="card-content">
                                    <div class="card-tags">
                                        <span class="tag tag--type">Mastery Test</span>
                                    </div>
                                    <h3 class="card-title">Place Value Mastery</h3>
                                    <p class="card-meta">Complete the previous lesson to unlock.</p>
                                </div>
                                <div class="card-state-icon" aria-hidden="true"><i class="fa-solid fa-lock"></i></div>
                            </div>

                        </div>
                        </section>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Overlay (shared) -->
    <div id="modal-overlay" class="portal-modal-overlay" hidden></div>

    <!-- Completed Lesson Modal -->
    <div id="lesson-completed-modal"
        class="portal-modal lesson-modal lesson-modal--completed"
        role="dialog" aria-modal="true" aria-labelledby="completed-title" hidden>
    <div class="portal-modal-content">
        <h2 id="completed-title" class="portal-modal-title">Lesson Complete!</h2>
        <p class="portal-modal-description">
        You’ve already finished this lesson. Would you like to review or start fresh?
        </p>
        <div class="portal-modal-actions">
        <button type="button" class="btn-portal-primary" data-action="review">Review lesson</button>
        <button type="button" class="btn-portal-exit" data-action="reset">Reset progress</button>
        </div>
    </div>
    </div>

    <!-- Locked Lesson Modal -->
    <div id="lesson-locked-modal"
        class="portal-modal lesson-modal lesson-modal--locked"
        role="dialog" aria-modal="true" aria-labelledby="locked-title" hidden>
    <div class="portal-modal-content">
        <h2 id="locked-title" class="portal-modal-title">Jump to this lesson?</h2>
        <p class="portal-modal-description">
        Earlier lessons stay locked. 100% requires finishing all lessons.
        </p>
        <div class="portal-modal-actions">
        <button type="button" class="btn-portal-primary" data-action="jump">Jump anyway</button>
        <button type="button" class="btn-portal-exit" data-action="goto-current">Go to current</button>
        </div>
    </div>
    </div>

    <!-- Vendor Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
    <script src="https://lambda.in.th/assets_dashboard/js/bootstrap.min.js?v=1754330467"></script>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://lambda.in.th/assets_dashboard/js/slick.min.js?v=1754330467"></script>
    <script src="https://lambda.in.th/assets_dashboard/js/main.js?v=1754330467"></script>
    <script src="https://lambda.in.th/assets/cusmike/sweet2/sweetalert2.min.js?v=1754330467"></script>
    <script src="https://lambda.in.th/assets/cusmike/toastr/toastr.min.js?v=1754330467"></script>
    <script src="https://lambda.in.th/assets_dashboard/js/tooltip.js?v=1754330467"></script>
    <script src="https://lambda.in.th/assets_dashboard/js/viewport-fix.js?v=1754330467"></script>
    <script src="js/modal-handler.js"></script>
    <script>
(function(){
  function ensureShowHideShim(){
    const originalOpen = window.openModal;
    window.openModal = function(id, trigger){
      const modal = document.getElementById(id);
      const overlay = document.getElementById('modal-overlay');
      if (!modal || !overlay) return;
      overlay.removeAttribute('hidden');
      modal.removeAttribute('hidden');
      if (originalOpen) { originalOpen(id, trigger); }
      else {
        overlay.classList.add('active');
        modal.classList.add('active');
        document.body.setAttribute('data-current-modal', id);
      }
      const firstBtn = modal.querySelector('.portal-modal-actions button,[data-action]');
      if (firstBtn) firstBtn.focus();
    };

    const originalClose = window.closeModal;
    window.closeModal = function(){
      const id = document.body.getAttribute('data-current-modal');
      const modal = id ? document.getElementById(id) : null;
      const overlay = document.getElementById('modal-overlay');
      if (originalClose) { originalClose(); }
      else {
        modal && modal.classList.remove('active');
        overlay && overlay.classList.remove('active');
        document.body.removeAttribute('data-current-modal');
      }
      if (modal) modal.setAttribute('hidden','');
      if (overlay) overlay.setAttribute('hidden','');
    };
  }

  ensureShowHideShim();

  function populateCompleted(card){
    const modal = document.getElementById('lesson-completed-modal');
    const titleEl = document.getElementById('completed-title');
    const descEl  = modal.querySelector('.portal-modal-description');
    const name = card.dataset.title || card.querySelector('.card-title')?.textContent || 'this lesson';
    titleEl.textContent = 'Lesson Complete!';
    descEl.textContent = 'You\'ve already finished this lesson. Would you like to review or start fresh?';
    modal.dataset.reviewUrl  = card.dataset.reviewUrl  || '#';
    modal.dataset.restartUrl = card.dataset.restartUrl || '#';
  }

  function populateLocked(card){
    const modal = document.getElementById('lesson-locked-modal');
    const titleEl = document.getElementById('locked-title');
    const descEl  = modal.querySelector('.portal-modal-description');
    titleEl.textContent = 'Jump to this lesson?';
    descEl.textContent = 'Earlier lessons stay locked. 100% requires finishing all lessons.';
    modal.dataset.startUrl   = card.dataset.startUrl   || '#';
    modal.dataset.currentUrl = card.dataset.currentUrl || '#';
  }

  // Delegate clicks on lesson cards
  document.addEventListener('click', function(e){
    const card = e.target.closest('.lesson-card');
    if (!card) return;

    if (card.classList.contains('is-current')) {
      // allow normal navigation
      return;
    }

    if (card.classList.contains('is-completed')) {
      e.preventDefault();
      populateCompleted(card);
      openModal('lesson-completed-modal', card);
      return;
    }

    if (card.classList.contains('is-locked')) {
      e.preventDefault();
      populateLocked(card);
      openModal('lesson-locked-modal', card);
      return;
    }
  });

  // Keyboard support for locked card (Enter/Space)
  document.addEventListener('keydown', function(e){
    if (e.key !== 'Enter' && e.key !== ' ') return;
    const card = document.activeElement && document.activeElement.closest ? document.activeElement.closest('.lesson-card.is-locked') : null;
    if (!card) return;
    e.preventDefault();
    populateLocked(card);
    openModal('lesson-locked-modal', card);
  });

  // Wire modal buttons
  document.getElementById('lesson-completed-modal')
    .addEventListener('click', function(e){
      const btn = e.target.closest('button'); if (!btn) return;
      const modal = e.currentTarget;
      if (btn.dataset.action === 'review') {
        btn.disabled = true; window.location.assign(modal.dataset.reviewUrl || '#');
      } else if (btn.dataset.action === 'reset') {
        btn.disabled = true; window.location.assign(modal.dataset.restartUrl || '#');
      }
    });

  document.getElementById('lesson-locked-modal')
    .addEventListener('click', function(e){
      const btn = e.target.closest('button'); if (!btn) return;
      const modal = e.currentTarget;
      if (btn.dataset.action === 'jump') {
        btn.disabled = true; window.location.assign(modal.dataset.startUrl || '#');
      } else if (btn.dataset.action === 'goto-current') {
        btn.disabled = true; window.location.assign(modal.dataset.currentUrl || '#');
      }
    });
})();
</script>

    <!-- Sidebar and UI Interactions -->
    <script>
        $(document).ready(function () {
            // Handle sidebar expansion based on screen size
            const handleSidebar = () => {
                const sidebar = $("#sidebar");
                if (!sidebar.length) return;

                if (window.matchMedia("(max-width: 1024px)").matches) {
                    sidebar.removeClass("expand");
                } else {
                    sidebar.addClass("expand");
                }
            };

            handleSidebar();
            $(window).resize(handleSidebar);

            // Handle journey box clicks
            const boxJourneys = document.querySelectorAll(".box-item-journey");
            boxJourneys.forEach(box => {
                box.addEventListener("click", () => {
                    boxJourneys.forEach(b => b.classList.remove("active-journey"));
                    box.classList.add("active-journey");
                });
            });

            // Handle content choice clicks
            const boxContentChoices = document.querySelectorAll(".box-content-choice");
            boxContentChoices.forEach(box => {
                box.addEventListener("click", () => {
                    boxContentChoices.forEach(b => b.classList.remove("answer-success"));
                    box.classList.add("answer-success");
                });
            });

            // Handle filter review box clicks
            const boxContentFilterReview = document.querySelectorAll(".box-border");
            boxContentFilterReview.forEach(box => {
                box.addEventListener("click", () => {
                    boxContentFilterReview.forEach(b => b.classList.remove("active-box-filter-review"));
                    box.classList.add("active-box-filter-review");
                });
            });
        });

        // Logout function
        function logoutChild() {
            const parentId = localStorage.getItem("parent_id");
            if (parentId != 0) {
                $.ajax({
                    type: "POST",
                    url: "dashboard-child/parent/logout",
                    data: {
                        "_token": "YKrhpMXr10shL8BLBIxa85cZRfOPWYREszRDvMap",
                        parent_id: parentId,
                    },
                    dataType: "json",
                    success: function (data) {
                        localStorage.removeItem("parent_id");
                        if (data.status == 200) {
                            location.href = "https://lambda.in.th/dashboard";
                        } else {
                            location.reload();
                        }
                    }
                });
            }
        }

        // Open question modal
        function openQuestionModal() {
            const myModal = new bootstrap.Modal(document.getElementById("myQuestionModal"));
            myModal.show();
        }
    </script>

    <!-- Learning Journey Logic -->
    <script>
        // Initialize variables
        const fullUrl = window.location.href;
        const pathname = window.location.pathname.replace("/", "");
        const journeyId = pathname.split("/")[3];
        const subjectId = pathname.split("/")[4];
        const userId = document.querySelector('input[name="userId"]').value;
        const progressBar = document.querySelector(".skill-progress");
        const completeIcon = document.createElement("i");
        completeIcon.className = "fa-solid fa-check";
        const playIcon = document.createElement("i");
        playIcon.className = "fa-solid fa-play";
        const practiceIcon = document.createElement("i");
        practiceIcon.className = "fa-solid fa-edit";
        let practices = 0;
        let lessons = 0;

        // Create tabs container
        const tabs = document.createElement("div");
        tabs.id = "canvas-TabContent";
        tabs.classList.add("tab-content");

        // Fetch lessons data
        const getLessons = async () => {
            try {
                const request = await fetch(`${fullUrl}/get/lessons`);
                if (!request.ok) throw new Error(request.statusText);
                const response = await request.json();
                fetchLessonsData(response);
            } catch (error) {
                console.error("Error fetching lessons:", error);
            }
        };
        getLessons();

        // Process lessons data
        const fetchLessonsData = (data) => {
            console.log("All data >>> ", data);
            lessons = data.lessons.length;
            const latest = data.learning.latest || null;
            const allLatest = data.learning.all_latest ? JSON.parse(data.learning.all_latest) : null;
            console.log("All latest >>> ", allLatest);
            const latestType = data.learning.latest_type || "lesson";
            const active = { type: null, id: null };

            const posts = document.getElementById("posts");
            const contElement = document.querySelector(".count");
            contElement.querySelector(".lesson").innerHTML = data.length;

            // Render lessons and practices
            data.lessons.forEach((lesson) => {
                const entryEl = document.createElement("div");
                entryEl.className = "entry";
                entryEl.dataset.id = lesson.id;
                entryEl.dataset.type = "lesson";
                entryEl.innerHTML = `
                    <div class="entry-timeline cursor-pointer" data-href="${fullUrl}/learning">
                        <i class="fa-solid fa-play" style="font-size: 16px !important;"></i>
                        <div class="timeline-divider"></div>
                    </div>
                    <div class="entry-title title-sm p-3">
                        <a data-href="${fullUrl}/learning" class="learn-this"><p class="fw-light">${lesson.name}</p></a>
                    </div>
                `;

                if (lesson.id == latest && latestType == "lesson") {
                    active.type = "lesson";
                    active.id = lesson.id;
                    const link = entryEl.querySelector("a");
                    link.href = link.dataset.href;
                    entryEl.querySelector(".cursor-pointer").onclick = (e) => {
                        location.href = e.target.closest(".cursor-pointer").dataset.href;
                    };
                }

                posts.append(entryEl);

                // Render practices
                lesson.practices.forEach((practice) => {
                    const practiceEl = document.createElement("div");
                    practiceEl.className = "entry";
                    practiceEl.dataset.id = practice.id;
                    practiceEl.dataset.type = "practice";
                    practiceEl.innerHTML = `
                        <div class="entry-timeline cursor-pointer" data-href="${fullUrl}/learning">
                            <i class="fa-solid fa-edit" style="font-size: 16px !important;"></i>
                            <div class="timeline-divider"></div>
                        </div>
                        <div class="entry-title title-sm p-3">
                            <a data-href="${fullUrl}/learning" class="learn-this"><p class="fw-light">Practices: ${practice.name}</p></a>
                        </div>
                    `;

                    if (practice.id == latest && latestType == "practice") {
                        active.type = "practice";
                        active.id = practice.id;
                        practiceEl.querySelector(".entry-timeline").classList.add("active");
                        const link = practiceEl.querySelector("a");
                        link.href = link.dataset.href;
                        practiceEl.querySelector(".cursor-pointer").onclick = (e) => {
                            location.href = e.target.closest(".cursor-pointer").dataset.href;
                        };
                    }

                    posts.append(practiceEl);
                });

                practices += lesson.practices.length;
            });

            // Handle initial state
            if (!latest) {
                const firstLink = posts.querySelector(".learn-this");
                firstLink.href = firstLink.dataset.href;
                firstLink.closest(".entry").querySelector(".cursor-pointer").onclick = (e) => {
                    location.href = e.target.closest(".cursor-pointer").dataset.href;
                };
            }

            // Mark completed entries
            if (data.learning.finished == 1) {
                posts.querySelectorAll(".entry").forEach((el) => {
                    el.querySelector(".entry-timeline")?.classList.add("complete");
                    el.querySelector(".active")?.classList.add("complete");
                    el.querySelector(".active")?.classList.remove("active");
                    el.querySelector("i")?.classList.add("fa-check");
                    el.querySelector("i")?.classList.remove("fa-edit");
                });
            }

            document.getElementById("jumpto").href = `${fullUrl}/learning`;

            // Mark completed entries before active entry
            let lastIndex = 0;
            posts.querySelectorAll(".entry").forEach((entry, index) => {
                if (Number(entry.dataset.id) == active.id && entry.dataset.type == active.type) {
                    lastIndex = index;
                }
            });

            posts.querySelectorAll(".entry").forEach((entry, index) => {
                if (index < lastIndex) {
                    entry.querySelector(".entry-timeline").classList.add("complete");
                    entry.querySelector(".fa-play")?.classList.add("fa-check");
                    entry.querySelector(".fa-edit")?.classList.add("fa-check");
                    entry.querySelector("a").href = `${fullUrl}/learning`;
                    entry.querySelector(".cursor-pointer").onclick = (e) => {
                        location.href = e.target.closest(".cursor-pointer").dataset.href;
                    };
                }
            });

            // Handle all latest entries
            if (allLatest && lastIndex == 0) {
                posts.querySelectorAll(".entry").forEach((el, index) => {
                    if (Number(el.dataset.id) == allLatest[index]) {
                        el.querySelector(".entry-timeline").classList.add("complete");
                        el.querySelector(".fa-play")?.classList.add("fa-check");
                        el.querySelector(".fa-edit")?.classList.add("fa-check");
                        el.querySelector("a").href = `${fullUrl}/learning`;
                        el.querySelector(".cursor-pointer").onclick = (e) => {
                            location.href = e.target.closest(".cursor-pointer").dataset.href;
                        };
                    }
                });

                const completedCount = posts.querySelectorAll(".complete").length;
                const lastEl = posts.querySelectorAll(".entry")[completedCount];
                lastEl.querySelector(".entry-timeline").classList.add("active");
                lastEl.querySelector(".fa-edit")?.classList.add("fa-play");
                lastEl.querySelector(".fa-edit")?.classList.remove("fa-edit");
                lastEl.querySelector("a").href = `${fullUrl}/learning`;
            }

            // Update counts and progress
            contElement.querySelector(".practice").innerHTML = practices;
            contElement.querySelector(".lesson").innerHTML = data.lessons.length;

            const completeCount = document.querySelectorAll(".complete").length;
            const percent = Math.round(completeCount * 100 / (lessons + practices));
            progressBar.dataset.percent = percent;
            progressBar.querySelector(".skill-progress-percent").style.width = `${percent}%`;
        };

        // Handle button clicks
        document.addEventListener("click", (e) => {
            const backBtn = e.target.closest("#back");
            if (backBtn) {
                window.location.replace("/dashboard-child/journey");
            }

            const resetBtn = e.target.closest("#reset");
            if (resetBtn && confirm("Confirm learning reset")) {
                learningReset().then(res => {
                    if (res.status != 200) {
                        alert(`${res.status} ${res.statusText}`);
                    } else {
                        location.reload();
                    }
                });
            }
        });

        // Reset learning progress
        const learningReset = async () => {
            try {
                const request = await fetch(`${window.location.href}/reset`);
                if (!request.ok) return request;
                return await request.json();
            } catch (error) {
                console.error("Error resetting learning:", error);
                return { status: 500, statusText: error.message };
            }
        };
    </script>
</body>
</html>